<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static',filename='Scretkey.css') }}"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/sha256.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.3/awesomplete.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.3/awesomplete.min.js"></script>
  </head>
  <body>
    <div id="secretKeyModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <p>Enter secret key:</p>
        <input type="password" id="secretKeyInput" />
        <button id="submitSecretKey">Submit</button>
      </div>
    </div>
    <div id="content">
      <nav class="navbar navbar-expand-lg">
        <a class="navbar-brand" href="#"
          ><img
            style="width: 10rem; height: 2rem"
            src="{{ url_for('static', filename='Gemini_Logo.png') }}"
            alt="Logo"
        /></a>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo02"></div>
      </nav>
      <div style="display: grid; grid-template-columns: 5% 95%">
        <div
          class="side-bar"
          style="
            height: 500px;
            width: 4rem;
            background: #092838;
            margin-left: 2px;
          "
        >
          <img
            id="your-hamburger-icon-id"
            style="
              width: 2rem;
              height: 2rem;
              margin-top: 1rem;
              margin-left: 1rem;
            "
            src="{{ url_for('static', filename='hamburger.png') }}"
            alt="hamburger"
          />
        </div>
        <div class="editor-wrapper">
          <div
            class="inner-editor-wrapper"
            style="
              background: #f1f1f1;
              height: 500px;
              width: 1190px;
              margin: 2px 10px;
              display: grid;
              grid-template-columns: 40% 60%;
            "
          >
            <div
              class="question-wrapper"
              style="
                height: 490px;
                width: 90%;
                background: #fff;
                margin-left: 0.5rem;
                margin-top: 0.5rem;
                border-radius: 14px 14px 14px 14px;
              "
            >
              <div
                class="question-heading"
                style="
                  height: 45px;
                  background: #c1ffe5;
                  font-size: 30px;
                  border-radius: 14px 14px 0px 0px;
                  line-height: normal;
                  font-weight: 400;
                  font-style: normal;
                  font-family: Roboto Slab;
                "
              >
                1. Question Title
              </div>
              <div class="question-statement" style="height: 160px"></div>
              <p
                class="sample-input"
                style="
                  line-height: normal;
                  font-weight: 400;
                  font-style: normal;
                  font-family: Hahmlet;
                  font-size: 15px;
                  margin-left: 15px;
                "
              >
                Sample Input 1
              </p>
              <div
                class="input-container"
                style="
                  background: rgba(233, 233, 233, 0.63);
                  border-radius: 10px;
                  height: 90px;
                  width: 93%;
                  margin-left: 15px;
                "
              ></div>
              <p
                class="sample-input"
                style="
                  line-height: normal;
                  font-weight: 400;
                  font-style: normal;
                  font-family: Hahmlet;
                  font-size: 15px;
                  margin-top: 5px;
                  margin-left: 15px;
                "
              >
                Sample Output 1
              </p>
              <div
                class="input-container"
                style="
                  background: rgba(233, 233, 233, 0.63);
                  border-radius: 10px;
                  height: 90px;
                  width: 93%;
                  margin-left: 15px;
                "
              ></div>
            </div>
            <div
              class="main-editor-wrapper"
              style="
                height: 100%;
                width: 100%;
                display: grid;
                grid-template-rows: 10% 60% 30%;
              "
            >
              <div
                class="editor-header-wrapper"
                style="display: flex; gap: 10px"
              >
                {% if session['role']=='Admin' %}
                <div>
                  <select id="dropdown">
                    <option value="">Select Languages</option>
                    <option value="71">Python</option>
                    <option value="76">C++</option>
                    <option value="62">Java</option>
                    <option value="Selenium">Selenium</option>
                  </select>
                </div>
                <div id="submission">
                  <select id="dropdown1">
                    <option value="">Submissions</option>
                  </select>
                </div>
                {% else %}
                <div>
                  <select id="dropdown">
                    <option value="">Select Languages</option>
                    <option value="71">Python</option>
                    <option value="76">C++</option>
                    <option value="62">Java</option>
                    <option value="Selenium">Selenium</option>
                  </select>
                </div>
                {% endif %}
                <div
                  class="icon-wrapper"
                  style="margin-left: auto; width: 50px"
                >
                  <i
                    class="fas fa-refresh"
                    id="reset"
                    style="font-size: large"
                  ></i>
                  <i
                    class="fa-solid fa-expand"
                    id="expand-icon"
                    style="font-size: large"
                  ></i>
                </div>
              </div>
              <div id="editor-container">
                <form method="POST" action="/submit">
                  {% if session['role']=='Admin' %}
                  <textarea
                    style="height: 250px"
                    class="form-control"
                    placeholder="Write Here....."
                    id="code_input"
                    name="code_input"
                    onkeydown="if(event.keyCode===9){
                  var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'\t'+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;
              }"
                  ></textarea>
                  {% else %}
                  <textarea
                    style="height: 250px"
                    class="form-control"
                    placeholder="Write Here....."
                    id="code_input"
                    name="code_input"
                    onkeydown="if(event.keyCode===9){
                      var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'\t'+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;
                  }"
                  ></textarea>
                  {% endif %}
                </form>
                <div
                  id="buttons-container"
                  style="
                    display: flex;
                    margin-top: 10px;
                    margin-left: auto;
                    justify-content: flex-end;
                    gap: 20px;
                  "
                >
                  {% if session['role']=='Admin' %}
                  <button
                    type="button"
                    style="
                      color: #fff;
                      text-align: center;
                      font-size: 15px;
                      font-style: normal;
                      font-weight: 700;
                      line-height: normal;
                      background-color: #35dba9;
                      border-radius: 3px;
                      border: none;
                      padding: 10px;
                    "
                    id="Runbtn"
                    onclick="disableButton()"
                    disabled
                  >
                    Run
                  </button>
                  <button
                    type="button"
                    style="
                      color: #fff;
                      text-align: center;
                      font-size: 15px;
                      font-style: normal;
                      font-weight: 700;
                      line-height: normal;
                      background-color: #35dba9;
                      border-radius: 3px;
                      border: none;
                      padding: 10px;
                    "
                    id="Executebtn"
                    onclick="disableButton()"
                    disabled
                  >
                    Submit
                  </button>
                  {% else %}
                  <button
                    type="button"
                    style="
                      color: #fff;
                      text-align: center;
                      font-size: 15px;
                      font-style: normal;
                      font-weight: 700;
                      line-height: normal;
                      background-color: #35dba9;
                      border-radius: 3px;
                      border: none;
                      padding: 10px;
                    "
                    id="Runbtn"
                  >
                    Run
                  </button>
                  <button
                    type="button"
                    style="
                      color: #fff;
                      text-align: center;
                      font-size: 15px;
                      font-style: normal;
                      font-weight: 700;
                      line-height: normal;
                      background-color: #35dba9;
                      border-radius: 3px;
                      border: none;
                      padding: 10px;
                    "
                    id="Executebtn"
                  >
                    Submit
                  </button>
                  {% endif %}
                </div>
              </div>
              <div class="result-wrapper" style="display: flex; gap: 100px">
                <div style="width: 300px">
                  <h6>Input</h6>
                  <textarea
                    name="input_area"
                    style="height: 100px; width: 300px"
                  >
                  </textarea>
                </div>
                <div style="width: 300px">
                  <h6>Output</h6>
                  <textarea
                    name="code_output"
                    style="height: 100px; width: 300px"
                  ></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    const secretKeyModal = document.getElementById("secretKeyModal");
    const secretKeyInput = document.getElementById("secretKeyInput");
    const submitSecretKeyButton = document.getElementById("submitSecretKey");
    const mainPage = document.querySelector(".hidden");
    const closeButton = document.querySelector(".close");
    const questionLink = document.getElementById("question-link");
    window.addEventListener("load", function () {
      var textarea = document.getElementById("code_input");
      textarea.value = "";
    });
    //In this we checking the Role based things
    var myValue = localStorage.getItem("role");
    if (myValue == "Admin") {
      console.log("this is admin");
      secretKeyModal.style.display = "none";
      document.getElementById("content").style.display = "block";
    } else {
      var sessionData = JSON.parse(localStorage.getItem("sessionData"));
      console.log("heloo");

      if (sessionStorage.getItem("secret") != null) {
        console.log("user is login");
        const secretKeyModal = document.getElementById("secretKeyModal");
        document.getElementById("content").style.display = "block";
        secretKeyModal.style.display = "none";
      } else {
        console.log("user is not login");
        const currentUrl = window.location.href;
        console.log(currentUrl);
        let UserKey = null;
        fetch(
          "https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableDataWithoutFile"
        )
          .then((response) => response.json())
          .then((data) => {
            for (let i = 0; i < data.length; i++) {
              console.log("enter");
              const item = data[i];
              if (currentUrl === item.url) {
                UserKey = item.SecretKey;
                break;
              }
            }
            console.log(UserKey);
            secretKeyModal.style.display = "block";
            secretKeyInput.focus();
            submitSecretKeyButton.addEventListener("click", () => {
              const validation = secretKeyInput.value.trim();
              if (validation === UserKey) {
                sessionStorage.setItem("secret", UserKey);
                document.getElementById("content").style.display = "block";
                secretKeyModal.style.display = "none";
              } else {
                alert("Invalid secret key, please try again!");
              }
            });
          })
          .catch((error) => console.error(error));
      }
    }

    // Add event listener to the close button
    closeButton.addEventListener("click", () => {
      secretKeyModal.style.display = "none";
    });

    function disableButton() {
      const button = document.getElementById("Runbtn");
      button.disabled = true;
    }
    document.addEventListener("DOMContentLoaded", function () {
      // Get the hamburger icon element
      var hamburgerIcon = document.getElementById("your-hamburger-icon-id");
      var expandIcon = document.getElementById("expand-icon");

      //expand-icon

      // Get the question-wrapper and main-editor-wrapper elements
      var questionWrapper = document.querySelector(".question-wrapper");
      var mainEditorWrapper = document.querySelector(".main-editor-wrapper");
      var innerEditorWrapper = document.querySelector(".inner-editor-wrapper");
      var initialGridTemplateColumns = "40% 60%";

      // Add a click event listener to the hamburger icon
      hamburgerIcon.addEventListener("click", function () {
        // Toggle the visibility of the question-wrapper
        questionWrapper.style.display =
          questionWrapper.style.display === "none" ? "block" : "none";

        innerEditorWrapper.style.gridTemplateColumns =
          innerEditorWrapper.style.gridTemplateColumns === ""
            ? initialGridTemplateColumns
            : "";
      });
      expandIcon.addEventListener("click", function () {
        // Toggle the visibility of the question-wrapper
        questionWrapper.style.display =
          questionWrapper.style.display === "none" ? "block" : "none";

        innerEditorWrapper.style.gridTemplateColumns =
          innerEditorWrapper.style.gridTemplateColumns === ""
            ? initialGridTemplateColumns
            : "";
      });
    });
  </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
  <script
    src="https://kit.fontawesome.com/3fcbd0cded.js"
    crossorigin="anonymous"
  ></script>
  <script src="{{ url_for('static', filename='index_updated.js') }}"></script>
</html>
