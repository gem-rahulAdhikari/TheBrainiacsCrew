<!DOCTYPE html>
<html>
<head>
	<title>Gem-Code Editor</title>
  <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static',filename='favicon.ico') }}">
  <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='question.css') }}">
  <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='admin.css') }}">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/sha256.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.3/awesomplete.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.3/awesomplete.min.js"></script>


</head>
<body>
  {% include "side-bar.html" %}
  <!-- <div id="add-data-btn">
  
  <button id="add-data-btn1">  <label>Add Data</label></button>
</div>  -->
<!-- <div id="addExcel" style="float: right;">
  
  
  <form method="POST"  action="/upload" enctype="multipart/form-data" style=" margin-top:10%; ">
    <input type="file" name="file" style="float: right; margin-left:50%;" >
    <input type="submit" value="Upload" style="margin-top:2%; margin-right:25%;">
  </form>
</div> -->
<!-- <div class="container">
<div class="row">
  <div class="col-md-12">
<div class="modal fade" id="resumeModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1>Title</h1>
            </div>
            <div class="modal-body">
        
            </div>
        <div class="modal-footer">
        <input class="btn btn-default" value="close">
        </div>
    </div>
   
  </div>

</div>
<a href="#" data-toggle="modal" data-target="#myModal">open Modal</a>
  </div>

</div>
</div> -->
<div class="modal fade" id="pdfModal" tabindex="-1" role="dialog" aria-labelledby="pdfModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
    <div class="modal-content" style="width:50vw !important;">
      <div class="modal-header" style="width:48vw !important;">
        <h5 class="modal-title" id="pdfModalLabel">Resume</h5>
        <button type="button" class="close" id="close-btn" data-dismiss="modal" aria-label="Close" style="position: absolute; top:0; right:0; margin-right:20rem; margin-top:6.5rem;" >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="overflow-y: auto;">
        <embed id="pdfEmbed" src="" type="application/pdf" width="100%" height="600px;">
      </div>
      
    </div>
  </div>
</div>


<div class="slide-alert alert alert-success">
 User Already added!
</div>
<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="display:none">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add Interviewee</h5>
        <button type="button" id="interview_close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="height: 300px; overflow-y: auto;">
        <form id="myForm">
          <div class="form-group">
            <label for="nameInput" class="label1">Name</label>
            <input type="text" class="form-control" id="nameInput" name="nameInput" placeholder="Enter">
          </div>
          <div class="form-group">
            <label for="emailInput" class="label1">Email</label>
            <input type="email" class="form-control" id="emailInput" name="email" placeholder="Enter">
          </div>
          <div class="form-group">
            <label for="recruiterInput" class="label1">Recruiter</label>
            <input type="text" class="form-control" id="recruiterInput" name="recruiter" placeholder="Enter">
          </div>
          <div class="form-group">
            <label for="experienceInput" class="label1">Experience</label>
            <div class="input-group">
              <label>Year</label>
              <input type="number" id="Year" name="Year" min="1" max="20">
              <label>Month</label>
              <input type="number" id="Month" name="Month" min="1" max="11">
            </div>
          </div>
          <div class="form-group">
            <label for="companyInput" class="label1">Current Company</label>
            <input type="text" class="form-control" id="companyInput" name="company" placeholder="Enter">
          </div>
          <div class="form-group">
            <label for="noticePeriodInput" class="label1">Notice Period</label>
            <!-- <input type="text" class="form-control" id="noticePeriodInput" name="noticePeriod" placeholder="Enter"> -->
            <select id="noticePeriodInput">
            <script>
              for (var i = 1; i <= 3; i++) {
                var optionText = i + " Month";
                document.write('<option value="' + i + '">' + optionText + '</option>');

                  // document.write('<option value="' + i + '">' + i + '</option>');
              }
          </script>
          </select>
          </div>
          <div class="form-group">
            <label for="lastWorkingDayInput" class="label1">Last Working Day</label>
            <input type="date" id="lwd" name="lwd" placeholder="Enter">
          </div>
          <div class="form-group">
            <label for="reasonforSwitch" class="label1">Reason for Switching</label>
            <textarea class="form-control" id="reasonforSwitch" name="reasonforSwitch" placeholder="Enter"></textarea>
          </div>
          <div class="form-group">
            <label for="cvInput" class="label1">Upload CV</label>
            <div class="custom-file">
              <input type="file" class="custom-file-input" id="cvInput" name="cvInput">
              <label class="custom-file-label" for="cvInput">Choose file</label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
         <button type="button" class="btn btn-primary" id="submitFormBtn">Submit</button>
      </div>
    </div>
  </div>
</div>

  

  <!--- modal for rounds update   -->
  <div id="myModal" class="modal2" style="display:none">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Interview Details</h5>
           <span class="close1" style="margin-left:200px;">&times;</span>
       
       
      </div>
    
    <!-- <h2>Interview Details</h2> -->
      <form id="my-form">
        <label for="round-type">Round Type:</label>
        <select id="round-type" name="round-type" class="round-input">
          <option value="Technical">Technical</option>
          <option value="Management">Management</option>
          <option value="custom">Custom</option>
        </select>
        <br><br>
        <div id="custom-round-type" style="display:none;">
          <label for="custom-round-type-input">Custom Round Type:</label>
          <input type="text" id="custom-round-type-input" name="custom-round-type-input" class="round-input">
          <br><br>
        </div>
        <label for="round-date">Round Date:</label>
        <input type="date" id="round-date" name="round-date" class="round-input"><br><br>
        <div>
          <button type="submit">Submit</button>
        </div>
      </form>
      
      
    </div>
  </div>
  </div>
  <!--This modal is for question selections for a particular user-->
  <!-- <div id="myModal23" class="modal4" style="display:none">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Questions</h5>
        <span class="close123">&times;</span>
      </div>
  
      <form id="my-form">
        <input type="text" id="search-input" onkeyup="searchTable1()" placeholder="Search...">
        <div id="labels-container"></div>
        <button type="submit">Submit</button>
      </form>
    </div>
  </div> -->
  <!-- <div class="modal fade" id="myModal23" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="display:none">
    <div class="modal-dialog" role="document">
      <div class="modal-content1">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Questions</h5>
          <button type="button" class="close123" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="mainbody">
          <div id="tags">
            <div class="custom-dropdown">
              <div style="display: flex; align-items: center;">
                <h1>Topics</h1>
                <button class="dropdown-toggle" style="background-color: white;" type="button" id="dropdownToggle" aria-haspopup="true" aria-expanded="false">
                  <i class="fa-solid fa-circle-chevron-down"></i>
                </button>
              </div>
              <div class="dropdown-menu" aria-labelledby="dropdownToggle" id="dropdownMenu">
                
              </div>
            </div>
          </div>

            <div id="complexity">
              <div class="custom-dropdown1">
                <div style="display: flex; align-items: center;">
                  <h1 >Difficulty</h1>
                <button class="dropdown-toggle1" type="button"  style="background-color: white;" id="dropdownToggle1" aria-haspopup="true" aria-expanded="false">
                  <i class="fa-solid fa-circle-chevron-down"></i>
                </button>
                <div class="dropdown-menu1" aria-labelledby="dropdownToggle" id="dropdownMenu1">
                </div>
              </div>
              </div>
            </div>
            <div id="question-container">
              <h1>Problems</h1>
              <div id="innerQuestion-container"></div>
              
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="selectbtn">select</button>
            <form id="my-form">
            <button type="button" class="btn btn-primary" style="margin-left:250px;" id="submitFormBtn1">submit</button>
           </form>
          </div>
          </div>
          </div>
          </div> -->

          <div class="modal fade" id="myModal23" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="display:none">
            <div class="modal-dialog" role="document">
              <div class="modal-content1"  style="width:50vw !important; height:85vh !important;">
                <div class="modal-header" style="width:48vw !important;">
                  <h5 class="modal-title" id="exampleModalLabel">Questions</h5>
                  <button type="button" class="close123" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body" id="mainbody">
                <div class="dropdown-container" style="border:2px solid black;">
                    <div id="tags">
                      <div class="custom-dropdown">
                        <div style="display: flex; align-items: center;">
                          <h1>Topics</h1>
                          <button class="dropdown-toggle" style="background-color: white;" type="button" id="dropdownToggle" aria-haspopup="true" aria-expanded="false">
                            <i class="fa-solid fa-circle-chevron-down"></i>
                          </button>
                        </div>
                        <div class="dropdown-menu" aria-labelledby="dropdownToggle" id="dropdownMenu">
                          
                        </div>
                      </div>
                    </div>
                    <div id="complexity">
                      <div class="custom-dropdown1">
                        <div style="display: flex; align-items: center;">
                          <h1 >Difficulty</h1>
                        <button class="dropdown-toggle1" type="button"  style="background-color: white;" id="dropdownToggle1" aria-haspopup="true" aria-expanded="false">
                          <i class="fa-solid fa-circle-chevron-down"></i>
                        </button>
                        <div class="dropdown-menu1" aria-labelledby="dropdownToggle" id="dropdownMenu1">
                        </div>
                      </div>
                      </div>
                    </div>
                    <div style="display: flex; justify-content: flex-end; padding: 10px;">
                      <button type="button" class="btn btn-primary" id="selectbtn">
                        <i class="fa-brands fa-searchengin"></i>
                      </button>
                    </div>
                </div>

            <div class="container">
              <div class="row">
                  <div class="col-2" style="height: 50vh; width:20vw;">
                      <div class="sidebar" >
                        <ul id="questionList">
                            
                        </ul>
                    </div>
                  </div>
                  <div class="col-3 offset-7" style=" height: 50vh; width:50vw;">
                    <div class="new-div" id="statement" style=" height: 50vh;">
                     </div>
                  </div>
              </div>
          </div>
          </div>
          <div class="modal-footer">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <form id="my-form" style="margin-left: 10px;">
                <button type="button" class="btn btn-primary" id="submitFormBtn1">submit</button>
              </form>
              <!-- <button type="button" class="btn btn-primary" id="selectbtn">select</button> -->
              <!-- <button type="button" class="btn btn-primary" id="customButton">
                <i class="fa-brands fa-searchengin"></i>
              </button> -->
            </div>
          </div>
        </div>
      </div>
    </div>
    
    
    
                 


  <!--     -->
    <button id="logout-button" type="button">Logout</button>
    <!-- <h1 >Admin Page</h1>
    <div class="text-center">
      <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Search...">
      {{role}}
      
     </div> -->
     <main class="table">
      <section class="table__header">
          <h1>Admin Table</h1>
          <div class="input-group" id="input-group1">
              <input id="searchInput" onkeyup="searchTable()" type="search" placeholder="Search Data..." style="width: 300px; height: 30px;">
         </div>
         <select id="monthDropdown" class="form-select" aria-label="Select Month">
          <option value="" selected>Select Month</option>
          <option value="1">January</option>
          <option value="2">February</option>
          <option value="3">March</option>
          <option value="4">April</option>
          <option value="5">May</option>
          <option value="6">June</option>
          <option value="7">July</option>
          <option value="8">August</option>
          <option value="9">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>
        {% if role == 'HR' or role == 'Admin' %}
         <div id="add-data-btn">
  
          <button id="add-data-btn1">  <label>Add Data</label></button>
        </div> 
        {% endif %}
          
      </section>
   <section class="table__body">
    <!-- <div style="overflow: auto; max-height: 500px; overflow-x: auto;"> -->
      <table id="dataTable" class="myTable" style="table-layout: auto; width: 100%;">
      <!-- <table id="dataTable" class="myTable" style="table-layout: fixed;"> -->
        <thead>
            <tr>
              <th>S.No<span class="icon-arrow">&UpArrow;</span></th>
                {% for header in headers %}
                {% if header == 'KEYSTATUS'  %}
                {% elif header == 'ENDMONTH'  %}
                {% else %}
                  <th data-column="{{ loop.index0 }}" data-order="desc">{{ header }}<span class="icon-arrow">&UpArrow;</span></th>
                  {% endif %}
                {% endfor %}
                {% if role == 'Admin' or role == 'HR' %}
                <th>Interview Status</th>
                <th>Interview Rounds</th>
                {% endif %}
                <th>Question</th>
                {% if role == 'Admin' %}
                <th>Delete</th>
                {% endif %}
              </tr>
            
        
        </thead>
        <tbody>
         
          {% for d in data %}
          {% set index = loop.index0 %}
          <tr>
            
            <td  >{{loop.index}}</td>
            {% for key, value in d.items() %}
            {% if key == '_id'  %}
            <td class="editable" contenteditable="false" data-key="_id" data-id="{{ d._id }}">{{ value }}</td>
            {% elif key == 'keyStatus'  %}
           
            {% elif key == 'EndMonth' %}

            {% elif key == 'CombinedKey'  %}
              {% if role == 'HR' or role == 'Admin' or role == 'Interviewer' %}
            <td class="input-td">
              <div>
                <label for="url" class="reqLabel" style="float:left;" >URL:</label>
                <span class="copy-icon" onclick="copyToClipboard('{{ value.split()[0] }}')">
                  <i class="fa-sharp fa-solid fa-eye" ></i>
                </span>
              </div>
              <div>
                <label for="secret-key" class="reqLabel" style="float: left;">Secret Key:</label>
               
                <span class="copy-icon" onclick="copyToClipboard('{{ value.split()[1] }}')">
                  <i class="fa-solid fa-key" style=" margin-right: 10%;"></i>
                 </span>
                
                <button id="key_btn" data-id="{{ id }}" data-secret-key="{{ value.split()[1] }}" style="margin-right:50%; float: left; margin-top: 8%;" >Start
                </button>
               
                
              </div>
            </td>
            {% endif %}
            {% elif key == 'Status'  %}
            <td class="status-cell" data-key="Status" data-id="{{ d._id }} ">
              <select id="status-dropdown">
                <option value="onHold">onHold</option>
                <option value="Pass">Pass</option>
                <option value="Rejected">Rejected</option>
              </select>
            </td>
            {% elif key == 'Name'  %}
            <td class="editable" id="name" contenteditable="false" data-key="Name" data-id="{{ d._id }}">
             {{ value }}</td>
            {% elif key == 'Recruiter'  %}
            <td class="editable" contenteditable="false" data-key="Recruiter" data-id="{{ d._id }}">{{ value }}</td>
            {% elif key == 'Current_Company'  %}
            <td class="editable" contenteditable="false" data-key="Current_Company" data-id="{{ d._id }}">{{ value }}</td>
            {% elif key == 'Experience'  %}
            <td class="editable" contenteditable="false" data-key="Experience" data-id="{{ d._id }}">{{ value }}</td>
            {% elif key == 'Month'  %}
            <td class="editable" contenteditable="false" data-key="Month" data-id="{{ d._id }}">{{ value }}</td>
           
            {% else %}
            <td>{{ value }}</td>
            {% endif %}
            {% endfor %}
            {% if role == 'HR' or role == 'Admin' %}
            <td>
              <select id="">
                <option value="Onboarding">Onboarding</option>
                <option value="Round1">Round 1</option>
                <option value="Round2">Round 2</option>
                <option value="Round3">Round 3</option>
                <option value="Management">Management</option>
                <option value="HR">HR</option>
              </select>
            </td>
            <td>
              <i id="add-round-btn" class="fa-solid fa-square-plus" data-id="{{ d._id }}"></i>
              <select id="my-dropdown">
                <option value="">Interview</option>
              </select>
              <div id="interview-rounds"></div>
            </td>
            {% endif %}
            {% if role == 'HR' or role == 'Admin' or role == 'Interviewer' %}
            
            <td>
            
              <i id="add-round-btn1" class="fa-solid fa-square-plus" data-id="{{ d._id }}" data-url="{{ d.CombinedKey.split()[0] }}"></i>
            </td>
            {% endif %}
            {% if role == 'Admin' %}
            <td><i class="fa-solid fa-trash" data-id="{{ d._id }}"></i></td>
            {% endif %}
           
           
          </tr>
          {% endfor %}
        </tbody>
        
      </table>
    <!-- </div> -->
    </section>
    </main>
</body>


<script>
  $(document).ready(function() {
  $('#round-type').on('change', function() {
    if ($(this).val() === 'custom') {
      $('#custom-round-type').show();
    } else {
      $('#custom-round-type').hide();
    }
  });
});
$('th').on('click',function(){
  var column=$(this).data('column');
  var order=$(this).data('order');
  console.log('column was clicked',column, order);
  if(order=='desc')
  {
$(this).data('order','asc')
  }
  else
  {
    $(this).data('order','asc')
  }
})
localStorage.setItem('role',`{{role}}`);
const recruiterInput = document.getElementById('recruiterInput');
const recruiterNames = ['Rahul', 'Bob', 'David', 'Karan']; // replace with your list of recruiter names

new Awesomplete(recruiterInput, {
  list: recruiterNames,
  minChars: 1,
  autoFirst: true,
  filter: Awesomplete.FILTER_STARTSWITH
});

recruiterInput.addEventListener('input', function() {
  // filter the recruiter names based on user input
  const filteredRecruiterNames = recruiterNames.filter(name =>
    name.toLowerCase().startsWith(this.value.toLowerCase())
  );

  // update the awesomplete object's list with filtered names
  // awesomplete.list = filteredRecruiterNames;
});

//dropdown 

var currentMonth = new Date().getMonth() + 1; // +1 since getMonth() returns zero-based index

  // Set the selected attribute on the option with the matching value
  var monthDropdown = document.getElementById('monthDropdown');
  var options = monthDropdown.options;
  for (var i = 0; i < options.length; i++) {
    if (options[i].value == currentMonth) {
      options[i].selected = true;
      break;
    }
  }
//-------------downlaod Resume---------------

var closePopupButton = document.getElementById('close-btn');
var pdfEmbed = document.getElementById('pdfEmbed');

var pdfModal = document.getElementById('pdfModal');



//--------------------
let download = document.querySelectorAll('#name');
download.forEach(function(td) {
  td.addEventListener('click', function() {
    const rowId = td.getAttribute('data-id');
    let pdf_data='';
    fetch("https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData")
      .then(response => response.json())
      .then(data => {
        data.forEach(item => {
        console.log(item['_id'])
        if(rowId==item['_id'])
        {
          const file_string = item['Resume']
          if(file_string !=null)
          {
            let file_data = file_string['data'] || '';
            pdf_data=file_data
            console.log(pdf_data);
            var downloadLink = document.createElement('a');
            downloadLink.href = pdf_data;  
            downloadLink.download = 'StarBus_ _ UTC Online 4.0.pdf';  
            downloadLink.textContent = 'Download PDF';
            console.log(downloadLink)
  
  pdfEmbed.setAttribute('src', pdf_data);
  pdfModal.style.display = "block";          
}
        }
        
          });
         
      })
      .catch(error => {
        console.error("Error fetching data:", error);
        });
    
  });
});
closePopupButton.addEventListener('click',()=>{
  pdfModal.style.display = "none"; 
});
const downloadResume = document.querySelectorAll('#downloadResume');
//  const downloadResume = document.querySelectorAll('#resumeLink');


downloadResume.forEach(button => {
  button.addEventListener('click', () => {
    console.log("clicked");
    const rowId = button.dataset.id;
    let pdf_data='';
    fetch("https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData")
      .then(response => response.json())
      .then(data => {
        data.forEach(item => {
        console.log(item['_id'])
        if(rowId==item['_id'])
        {
          const file_string = item['Resume']
          if(file_string !=null)
          {
            let file_data = file_string['data'] || '';
            pdf_data=file_data
            console.log(pdf_data);
            var downloadLink = document.createElement('a');
            downloadLink.href = pdf_data;  
            downloadLink.download = 'StarBus_ _ UTC Online 4.0.pdf';  
            downloadLink.textContent = 'Download PDF';
            console.log(downloadLink)
            var newWindow = window.open();
  if (newWindow === null) {
   
  } else {
    newWindow.document.open();
    newWindow.document.write('<embed src="' +pdf_data + '" type="application/pdf" width="100%" height="100%"/>');
    newWindow.document.close();
  }
          }
        }
        
          });
         
      })
      .catch(error => {
        console.error("Error fetching data:", error);
        });
       
   });
  });


//------Question Modal
const maindiv = document.getElementById('tags');
   const maindiv1 = document.getElementById('complexity');
   let questionKey='';
const addQuestions = document.querySelectorAll('#add-round-btn1');
const tagspan=document.getElementById('dropdownMenu');
const complexityspan=document.getElementById('dropdownMenu1')
const problemspan=document.getElementById('problemspan');
const questionContainer = document.getElementById('innerQuestion-container');
var tagValues='';
var complexityValues=''
// addQuestions.forEach(button => {
//   button.addEventListener('click', () => {
//     console.log("clicked");
//     const rowId = button.dataset.id;
//     const url = button.dataset.url;
//     console.log(rowId);
//     console.log(url);
//     const labelsContainer = document.getElementById("labels-container");
//   fetch("https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getQuestion")
//       .then(response => response.json())
//       .then(data => {
//         data.forEach(item => {
//           const keys = Object.keys(item).slice(0, -1); // Exclude the last key
//          keys.forEach(key => {
//             const checkbox = document.createElement("input");
//             checkbox.type = "checkbox";
//             checkbox.value = key;
//             const label = document.createElement("label");
//             label.textContent = item[key].Question;
//             labelsContainer.appendChild(checkbox);
//             labelsContainer.appendChild(label);
//             labelsContainer.appendChild(document.createElement("br"));
//           });
//         });
//         const modal12 = document.getElementById('myModal23');
//         modal12.style.display = "block";
//         const closeButton = document.querySelector('#close123');
//         closeButton.addEventListener('click', () => {
//           console.log("this close");
//           modal12.style.display = "none";
//          });
//          const form = modal12.querySelector('form');
//         if (!form._listenerAttached) { // Check if the event listener is already attached
//           form._listenerAttached = true; // Mark the form as having the event listener attached
//           form.addEventListener('submit', function(event) {
//             event.preventDefault();
//             const selectedOptions = Array.from(labelsContainer.querySelectorAll('input[type="checkbox"]:checked'))
//               .map(checkbox => checkbox.value);
//              console.log(selectedOptions); // or perform any other action with the selected options
//             const formData = {
//               selectedOptions: selectedOptions,
//               url:url
//             };
//             fetch('/question', {
//               method: 'POST',
//               headers: {
//                 'Content-Type': 'application/json'
//               },
//               body: JSON.stringify(formData)
//             })
//               .then(response => {
//                 if (response.ok) {
//                   console.log('Form data submitted successfully');
//                   location.reload();
//                   $('#myModal23').modal('hide');
//                 } else {
//                   console.error('Failed to submit form data');
//                 }
//               })
//               .catch(error => {
//                 console.error('Error:', error);
//               });
//           });
//         }
//       })
//       .catch(error => {
//         console.error("Error fetching data:", error);
//       });
//   });
// });
// const searchInput = document.getElementById('search-input');
// document.getElementById('my-form').addEventListener('submit', function(event) {
//   event.preventDefault(); // Prevent default form submission
//   const searchQuery = searchInput.value.toLowerCase();
//   const labelsContainer = document.getElementById('labels-container');
//   const labels = labelsContainer.getElementsByClassName('label');
// for (let i = 0; i < labels.length; i++) {
//     const label = labels[i];
//     const labelText = label.textContent.toLowerCase();
// if (labelText.includes(searchQuery)) {
//       label.style.display = 'block'; // Show matching labels
//     } else {
//       label.style.display = 'none'; // Hide non-matching labels
//     }
//   }
// });



addQuestions.forEach(button => {
  button.addEventListener('click', () => {
    console.log('clicked');
    const rowId = button.dataset.id;
    const url = button.dataset.url;
    // tagspan.innerHTML='';
    // complexityspan.innerHTML='';
    // questionContainer.innerHTML='';
    
    const apiUrl = `https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getQuestionsTags`;
   const apiUrl1 = `https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getQuestion`;
   fetch(apiUrl)
   .then(response=>response.json())
   .then(dataArray=>{
    const dropdownButton = document.getElementById('dropdownToggle');
  const dropdownMenu = document.getElementById('dropdownMenu');

  dropdownButton.addEventListener('click', function() {
    dropdownMenu.classList.toggle('show');
  });
    dataArray.forEach(data=>{
      const keys = Object.keys(data);
     const lastKeyIndex = keys.length - 1;
    for (let i = 0; i < lastKeyIndex; i++) {
         const key = keys[i];
         const value = data[key];
         const label = document.createElement('label');
         const checkbox = document.createElement('input');
               checkbox.type = 'checkbox';
               checkbox.value = value;
               label.appendChild(checkbox);
    label.appendChild(document.createTextNode(data[key]));

    const dropdownItem = document.createElement('div');
    dropdownItem.classList.add('dropdown-item');
    dropdownItem.appendChild(label);

    dropdownMenu.appendChild(dropdownItem);
}
 })
 const checkboxes = document.querySelectorAll('.custom-dropdown input[type="checkbox"]');
checkboxes.forEach(checkbox => {
  checkbox.addEventListener('change', function() {
    console.log(this.value, this.checked);
    tagValues=this.value;
  });
});
   })
   .catch(error=>{
    console.log(error);
   });
   var complexities = []; 
   var uniqueValues = [];
     fetch(apiUrl1)
   .then(response=>response.json())
   .then(data=>{
    const dropdownButton = document.getElementById('dropdownToggle1');
  const dropdownMenu = document.getElementById('dropdownMenu1');

  dropdownButton.addEventListener('click', function() {
    dropdownMenu.classList.toggle('show');
  });
    data.forEach(item => {
          const keys = Object.keys(item).slice(0, -1); // Exclude the last key
         keys.forEach(key => {
           complexities.push(item[key].Complexity);
           var uniqueSet = new Set(complexities);  
           uniqueValues = Array.from(uniqueSet);
          });
        });
        uniqueValues.forEach(value => {
       const label = document.createElement('label');
       const checkbox = document.createElement('input');
       checkbox.type = 'checkbox';
       checkbox.value = value;
       label.appendChild(checkbox);
    label.appendChild(document.createTextNode(value));

    const dropdownItem = document.createElement('div');
    dropdownItem.classList.add('dropdown-item');
    dropdownItem.appendChild(label);

    dropdownMenu.appendChild(dropdownItem);
});
const checkboxes = document.querySelectorAll('.custom-dropdown1 input[type="checkbox"]');
checkboxes.forEach(checkbox => {
  checkbox.addEventListener('change', function() {
    console.log(this.value, this.checked);
    complexityValues=this.value
  });
});
})
   const modal12 = document.getElementById('myModal23');
    modal12.style.display = "block";
    const closeButton = document.querySelector('.close123');
  closeButton.addEventListener('click', () => {
    modal12.style.display = "none";
    // questionContainer.innerHTML='';
  });
 

const selectButton = document.getElementById('selectbtn');
const statementDiv = document.getElementById('statement');
selectButton.addEventListener('click', function() {
  const checkboxestags = document.querySelectorAll('#tags input[type="checkbox"]:checked');
  const checkboxescomplexity = document.querySelectorAll('#complexity input[type="checkbox"]:checked');
  var selectedTags=tagValues;
  var selectedcomplex=complexityValues;
  console.log(selectedTags)
  console.log(selectedcomplex)
  var questionKey='';
  const apiUrl = `https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getQuestionsTags`;
  fetch(apiUrl)
  .then(response=>response.json())
  .then(data=>{
    data.forEach(item=>{
      Object.keys(item).forEach(key => {
        console.log(item[key]+"-----"+selectedTags)
        if(item[key]==selectedTags)
        {
          questionKey=key;
          // TagName(questionKey,selectedcomplex)
         }
      });
      });
      if (questionKey) {
        // questionContainer.innerHTML='';
      console.log(questionKey);
      const apiUrl1 = `https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getQuestion`;
      fetch(apiUrl1)
        .then(response => response.json())
        .then(data => {
          data.forEach(item=>{
      for (let key in item) {
            if (item[key].Tag_id == questionKey && item[key].Complexity==selectedcomplex) {
              console.log(item[key].Question);
              var questionWithCheckbox = document.createElement("div");
              var checkbox = document.createElement("input");
              checkbox.type = "checkbox";
              checkbox.name = "questionCheckbox";
              checkbox.value = item[key].objectId;
              questionWithCheckbox.appendChild(checkbox);
              var questionText = document.createElement("span");
              questionText.innerHTML = item[key].Question;
              questionWithCheckbox.appendChild(questionText);
              // questionContainer.appendChild(questionWithCheckbox)
              var questionList = document.getElementById("questionList");
              var listItem = document.createElement("li");
                  listItem.appendChild(questionWithCheckbox);
                  questionList.appendChild(listItem);
                  listItem.addEventListener("click", onItemClick);
             }

          }
          
      
    })
        })
        .catch(error => {
          console.log(error);
        });
       
    } else {
      console.log("questionKey is not set");
    }
  })
  .catch(error => {
    console.log(error);
  });
});

function onItemClick(event) {
    const itemText = event.target.textContent;
    //send the api request to find the statement of question

    fetch('https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getQuestion')
      .then(response => response.json())
      .then(data => {
        data.forEach(item => {
          for (let key in item) {
            if (item[key].Question == itemText) {
              console.log(item[key].Question);
              statementDiv.innerHTML = item[key]['Question Statement'];
              // questionHeading.innerHTML = `<strong>${item[key].Question}</strong>`;
              // questionStatements.innerHTML = item[key]['Question Statement'];
              // const obj = item[key]['Sample Testcases'];
              // questionCases.innerHTML='';
              // for (const value in obj) {
              //        questionCases.innerHTML += `<strong>Example </strong>${obj[value]['Input']}<br>${obj[value]['Output']}<br>`;
              //          }
              // questionConstraints.innerHTML = `<strong>Constraints </strong>${item[key]['Constraints']}`;
            }
          }
        });
      })
      .catch(error => {
        console.error("Error fetching data:", error);
      });
    // statementDiv.innerHTML = itemText;
    console.log(itemText); 
  }
const submitButton = document.getElementById('submitFormBtn1');
submitButton.addEventListener('click', function() {
 const checkboxesproblems = document.querySelectorAll('#question-container input[type="checkbox"]:checked');
const selectedValues = [];
var selectedproblem='';
checkboxesproblems.forEach(function(checkbox) {
selectedValues.push(checkbox.value);

  });
  console.log(selectedValues);
  // Create the request payload
const payload = {
  selectedValues: selectedValues,
  url: url
};

// Create the fetch request
fetch('/question', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(payload)
})
  .then(response => response.json())
  .then(data => {
    // Handle the response data
    console.log("get the response");
    const modal12 = document.getElementById('myModal23');
    modal12.style.display = "none";
  })
  .catch(error => {
    
  });
  
 });          
});
});
function createTableRow(dataItem) {
  // Create a new table row element
  const row = document.createElement('tr');
  for (const key in dataItem) {
    const value = dataItem[key];
    const cell = document.createElement('td');
    cell.textContent = value;
    row.appendChild(cell);
  }

  return row;
}
//---------------

document.getElementById("monthDropdown").addEventListener("change", function() {
    var selectedMonth = this.value;
    // Make the API request with the selectedMonth value
    // Example: Use fetch or XMLHttpRequest to send the request
    // Replace "YOUR_API_ENDPOINT" with your actual API endpoint
    fetch("/admin", {
      method: "POST",
      body: JSON.stringify({ month: selectedMonth }),
      headers: {
        "Content-Type": "application/json"
      }
    })
    .then(response => {
    if (response.ok) {
      return response.json(); // Parse the response as JSON
    } else {
      throw new Error("Request failed with status: " + response.status);
    }
  })
  .then(data => {
    console.log("Response data:", data); // Access the data here
    updateTable(data); // Call your function to update the table
  })
  .catch(error => {
    console.error("Error:", error); // Handle any errors
  });
});
  function newFunction(){
console.log("this is new fun")
  }
  function updateTable(data) {
  const tableBody = document.querySelector('#dataTable tbody');
  tableBody.innerHTML = '';

  data.forEach((item, index) => {
  const row = document.createElement('tr');

  // Set the row number
  const numberCell = document.createElement('td');
  numberCell.textContent = index + 1;
  row.appendChild(numberCell);

  // Status cell
  var emptyCell = document.createElement("td");
  var emptyText = " ";
  emptyCell.textContent = emptyText;
  row.appendChild(emptyCell);
  
  // var statusCell = document.createElement("td");
  // var statusText = item['Status'];
  // statusCell.textContent = statusText;
  // row.appendChild(statusCell);

  // Create the td element
var tdElement = document.createElement("td");
tdElement.classList.add("status-cell");
// Create the select element
var selectElement = document.createElement("select");
selectElement.setAttribute("id", "status-dropdown");
// Create the option elements
var option1 = document.createElement("option");
option1.setAttribute("value", "onHold");
option1.textContent = "onHold";
var option2 = document.createElement("option");
option2.setAttribute("value", "Pass");
option2.textContent = "Pass";
var option3 = document.createElement("option");
option3.setAttribute("value", "Rejected");
option3.textContent = "Rejected";
// Append the option elements to the select element
selectElement.appendChild(option1);
selectElement.appendChild(option2);
selectElement.appendChild(option3);
// Append the select element to the td element
tdElement.appendChild(selectElement);
row.appendChild(tdElement);


  // Name cell
  var nameCell = document.createElement("td");
  var nameText = item['Name'];
  nameCell.textContent = nameText;
  row.appendChild(nameCell);

  //Recruiter
  var recruiterCell = document.createElement("td");
  var recruiterText = item['Recruiter'];
  recruiterCell.textContent = recruiterText;
  row.appendChild(recruiterCell);

  //Experince
  var experienceCell = document.createElement("td");
  var experienceText = item['Experience'];
  experienceCell.textContent = experienceText;
  row.appendChild(experienceCell);

  //current company
  var currentCompanyCell = document.createElement("td");
  var currentCompanyText = item['Current_Company'];
  currentCompanyCell.textContent = currentCompanyText;
  row.appendChild(currentCompanyCell);

  //combine key
var CombinedKey = document.createElement("td");
var combinedKeyText = item['CombinedKey'];
var splitValues = combinedKeyText.split(' ');
console.log(splitValues[0]);

var divContainer = document.createElement("div");
divContainer.style.cssText = "float: left; display: block; clear: left;";


var urlLabel = document.createElement("label");
urlLabel.setAttribute("for", "url");
urlLabel.classList.add("reqLabel");
urlLabel.textContent = "URL:";

var urlSpan = document.createElement("span");
urlSpan.classList.add("copy-icon");
urlSpan.onclick = function() {
  copyToClipboard(splitValues[0]);
};

var urlIcon = document.createElement("i");
urlIcon.classList.add("fa-sharp", "fa-solid", "fa-eye");

urlSpan.appendChild(urlIcon);
divContainer.appendChild(urlLabel);
divContainer.appendChild(urlSpan);

var secretKeyDivContainer = document.createElement("div");
secretKeyDivContainer.style.cssText = "float: left; display: block; clear: left;";

var secretKeyLabel = document.createElement("label");
secretKeyLabel.setAttribute("for", "secret-key");
secretKeyLabel.classList.add("reqLabel");
secretKeyLabel.textContent = "Secret Key:";

var secretKeySpan = document.createElement("span");
secretKeySpan.classList.add("copy-icon");
secretKeySpan.onclick = function() {
  copyToClipboard(splitValues[1]);
};

var keyIcon = document.createElement("i");
keyIcon.classList.add("fa-solid", "fa-key");
// keyIcon.style.marginRight = "10%";

secretKeySpan.appendChild(keyIcon);
secretKeyDivContainer.appendChild(secretKeyLabel);
secretKeyDivContainer.appendChild(secretKeySpan);


var startButton = document.createElement("button");
startButton.id = "key_btn";
// startButton.setAttribute("data-id", id);
// startButton.setAttribute("data-secret-key", value.split()[1]);
startButton.style.marginRight = "50%";
startButton.style.float = "left";
startButton.style.marginTop = "8%";
startButton.textContent = "Start";

CombinedKey.appendChild(divContainer);
CombinedKey.appendChild(secretKeyDivContainer);
CombinedKey.appendChild(startButton);
row.appendChild(CombinedKey);

//Interview Status
var cell = document.createElement("td");

var dropdown = document.createElement("select");
dropdown.id = "";

var option1 = document.createElement("option");
option1.value = "Onboarding";
option1.textContent = "Onboarding";
dropdown.appendChild(option1);

var option2 = document.createElement("option");
option2.value = "Round1";
option2.textContent = "Round 1";
dropdown.appendChild(option2);

var option3 = document.createElement("option");
option3.value = "Round2";
option3.textContent = "Round 2";
dropdown.appendChild(option3);

var option4 = document.createElement("option");
option4.value = "Round3";
option4.textContent = "Round 3";
dropdown.appendChild(option4);

var option5 = document.createElement("option");
option5.value = "Management";
option5.textContent = "Management";
dropdown.appendChild(option5);

var option6 = document.createElement("option");
option6.value = "HR";
option6.textContent = "HR";
dropdown.appendChild(option6);

cell.appendChild(dropdown);

row.appendChild(cell);
//interview Rounds
var cell = document.createElement("td");

var addRoundBtn = document.createElement("i");
addRoundBtn.id = "add-round-btn";
addRoundBtn.classList.add("fa-solid", "fa-square-plus");
// addRoundBtn.setAttribute("data-id", d._id);

var dropdown = document.createElement("select");
dropdown.id = "my-dropdown";

var option = document.createElement("option");
option.value = "";
option.textContent = "Interview";
dropdown.appendChild(option);

var interviewRounds = document.createElement("div");
interviewRounds.id = "interview-rounds";

cell.appendChild(addRoundBtn);
cell.appendChild(dropdown);
cell.appendChild(interviewRounds);

row.appendChild(cell);

var QuestionCell = document.createElement("td");
var iElement = document.createElement("i");
iElement.id = "add-round-btn1";
iElement.classList.add("fa-solid", "fa-square-plus");
QuestionCell.appendChild(iElement);
row.appendChild(QuestionCell);


var deleteCell = document.createElement("td");
var iElement1 = document.createElement("i");
iElement1.classList.add("fa-solid", "fa-trash");
deleteCell.appendChild(iElement1);
row.appendChild(deleteCell);




  tableBody.appendChild(row);
});
}

//--------------
function onPageLoad() {

  // sortTable1('MONTHâ†‘', true);
  // Get all the dropdown elements in the table
  
  const dropdownElements = document.querySelectorAll('.status-cell select');
  const stbtn = document.querySelectorAll('#key_btn');
  var role = '{{ role }}';
  console.log(role);
  sessionStorage.setItem('role',role);
// const apiUrl1 = `https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData`;
const apiUrl1 = `https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableDataWithoutFile`;
// Make the API call using fetch or any other HTTP library
fetch(apiUrl1)
  .then(response => response.json())
  .then(dataArray => {

   
    dataArray.sort((a, b) => a.month- b.month);
    console.log(dataArray);
 
    //-------------
    let c = 0;
    stbtn.forEach(function(button) {
      console.log(dataArray[c].keyStatus);
      if (dataArray[c].keyStatus == 'T') {
        button.innerHTML = 'Stop';
      } else if (dataArray[c].keyStatus == 'F') {
        button.innerHTML = 'Start';
      }
  
      c++;
    });
  })
  .catch(error => {
    // Handle any errors that occurred during the API call
    console.error(error);
  });
//   let c=0;
//   //----------------------
//   stbtn.forEach(function(button) {
//     // button.style.backgroundColor = 'red'; // Change the color to your desired value
    
//     const apiUrl = `https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData`;

// // Make the API call using fetch or any other HTTP library
// fetch(apiUrl)
// .then(response => response.json())
// .then(dataArray => {
//   // Process the API response data array
//   console.log(dataArray);
//   console.log(dataArray[c].keyStatus);
//   if(dataArray[c].keyStatus=='T')
//   {
//     button.innerHTML="Stop"
//   }
//   else if(dataArray[c].keyStatus=='F')
//   {
//     button.innerHTML="Start"
//   }
  
//   c++;
// })
// .catch(error => {
//   // Handle any errors that occurred during the API call
//   console.error(error);
// });
//     });
//--------------
//     const apiUrl = `https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData`;

// // Make the API call using fetch or any other HTTP library
// fetch(apiUrl)
//   .then(response => response.json())
//   .then(dataArray => {
//     // Process the API response data array
//     console.log(dataArray);

//     let c = 0;
//     stbtn.forEach(function(button) {
//       console.log(dataArray[c].keyStatus);
//       if (dataArray[c].keyStatus == 'T') {
//         button.innerHTML = 'Stop';
//       } else if (dataArray[c].keyStatus == 'F') {
//         button.innerHTML = 'Start';
//       }
  
//       c++;
//     });
//   })
//   .catch(error => {
//     // Handle any errors that occurred during the API call
//     console.error(error);
//   });
}

function getRowId(element) {
  // Traverse up the DOM hierarchy to find the closest <tr> element
  const row = element.closest('tr');
  
  // Find the hidden column cell within the row
  const hiddenColumnCell = row.querySelector('td:nth-child(2)');
  
  if (hiddenColumnCell) {
    return hiddenColumnCell.textContent.trim();
  }
  
  return null; // Return null if _id value is not found
}


function setSelectedOption(selectElement, selectedValue) {
  const option = selectElement.querySelector(`option[value="${selectedValue}"]`);
  option.setAttribute('selected', 'selected');
}

document.addEventListener('DOMContentLoaded', onPageLoad);

const fetchedData='';

//----------------------------------------
document.addEventListener('DOMContentLoaded', function() {
  
  //-----------------------
  const tableRows = document.querySelectorAll('#dataTable tbody tr');
  tableRows.forEach(row => {
  const idCell = row.querySelector('td:nth-child(2)');
  const id = idCell.getAttribute('data-id');
  makeAPICall(id, row,fetchedData);
  });
});

function makeAPICall(id, row,fetchedData) {
  //1
  const apiUrl = `https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableDataWithoutFile`;
  // const apiUrl = `https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData`;
  fetch(apiUrl)
  .then(response => response.json())
  .then(dataArray => {
    dataArray.forEach(data => {
      if(id==data._id)
      {
        const status = data.Status;
        console.log(status);
      setColorForRow(status, row);
      }
    });
  })
  .catch(error => {
  });
  }
function setColorForRow(status, row) {
  const statusMap = new Map([
    ["Pass", "#138a36"],        // Green color in HEX format
    ["Rejected", "#E94540"]     // Red color in RGB format
  ]);
  
  const color = statusMap.get(status);
  
  if (color) {
    row.style.backgroundColor = color;
  }
}





//----------------------------------------------------

function copyToClipboard(value) {
  // Create a temporary input element
  var tempInput = document.createElement("input");
  tempInput.style.position = "absolute";
  tempInput.style.left = "-1000px";
  tempInput.value = value;
  
  // Append the input element to the body
  document.body.appendChild(tempInput);
  
  // Copy the value to the clipboard
  tempInput.select();
  document.execCommand("copy");
  
  // Remove the temporary input element
  document.body.removeChild(tempInput);
  alert('Copied!');
}



const table = document.getElementById("dataTable");
const rows = table.getElementsByTagName("tr");

// Loop through the rows and apply the class based on the status value



const statusMap = new Map([
["Pass", "#138a36"],        // Green color in HEX format
  ["Rejected", "#E94540"]   // Red color in RGB format
]);


const dropdowns2 = document.querySelectorAll("#status-dropdown");
dropdowns2.forEach(dropdown => {
  const selectedValue1 = localStorage.getItem("selectedStatus");
  if (selectedValue1) {
    dropdown.value = selectedValue1;
  }
  dropdown.addEventListener("change", function() {
    const newValue = this.value;
    const row = this.closest("tr");
    const rowId = row.querySelector('td:nth-child(2)').textContent;
    const statusCell = row.querySelector(".status-cell");
    const status = statusCell.textContent.trim();

    if (statusMap.has(newValue)) {
      row.style.backgroundColor = statusMap.get(newValue);
      localStorage.setItem(`selectedColor-${rowId}`, statusMap.get(newValue));
    } else {
      row.style.backgroundColor = "";
      localStorage.removeItem(`selectedColor-${rowId}`);  // Reset background color if status doesn't match
    }

    var data = {
      rowId: rowId,
      newValue: newValue,
      key: "Status",
    };

    // Send the data to the server using AJAX
    $.ajax({
      url: '/updateTable',
      type: 'POST',
      data: data,
      success: function(response) {
        // Handle success
      },
      error: function(xhr) {
        // Handle error
      }
    });

    // Store the selected value in local storage for the particular row
    localStorage.setItem(`selectedStatus-${rowId}`, newValue);
  });

  // Retrieve the selected value from local storage for the particular row
  const row = dropdown.closest("tr");
  // const rowId = row.querySelector('td:first-child').textContent;
  const rowId = row.querySelector('td:nth-child(2)').textContent;
  selectedValue = localStorage.getItem(`selectedStatus-${rowId}`);
  if (selectedValue1) {
    dropdown.value = selectedValue;
  }
  const selectedColor = localStorage.getItem(`selectedColor-${rowId}`);
  if (selectedColor) {
    row.style.backgroundColor = selectedColor;
  }
});


const modal1 = document.getElementById('myModal1');
const close=document.getElementById('interview_close');


$("#add-data-btn").on("click", function() {
  
  modal1.style.display = "block";
})
close.addEventListener('click', () => {
  // Add your code to handle the close button click event
  console.log("hello this is close");
  modal1.style.display = "none";
});
//-------------Insert user data in database

const hardcodedValues = {
  Status: "onHold",
  // Interview_Rounds: [
  //   {
  //     Round1: {
  //       Date: "2023-04-09",
  //       Round: "Technical",
  //       Feedback: "very good",
  //       Result: "None",
  //     }
  //   }
  // ],
 
};
var cvInput = document.getElementById('cvInput');
document.getElementById("submitFormBtn").addEventListener("click", async function() {
  console.log("hello");
  const Name = document.getElementById('nameInput').value;
  const Email = document.getElementById('emailInput').value;
  const Recruiter = document.getElementById('recruiterInput').value;
  //  const Experience = document.getElementById('experienceInput').value;
  const Month = document.getElementById('Month').value;
  const Year = document.getElementById('Year').value;
  const Notice_Period = document.getElementById('noticePeriodInput').value;
  const lastWorkingDay = document.getElementById('lwd').value;
  const reasonWatchForSwitching = document.getElementById('reasonforSwitch').value;
  var selectedFile = cvInput.files[0];
    console.log(selectedFile);
    var reader = new FileReader();
  reader.readAsDataURL(selectedFile);
  var demofile = '';
reader.onloadend = function() {
  var base64Data = reader.result;
  var fileObject = {
    name: selectedFile.name,
    type: selectedFile.type,
    size: selectedFile.size,
    data: base64Data
  };
  Resume=fileObject;
  console.log(fileObject);
};
const Experience = Year + " Yr & "+ Month +" Mo" 
const currentDate = new Date();
const StartMonth = currentDate.getMonth() + 1;
const EndMonth='';
  const Current_Company = document.getElementById('companyInput').value;
  let userAlreadyExists = false;
  fetch('https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData')
    .then(response => response.json())
    .then(data => {
      console.log(data);
      // Iterate over the data array
      data.forEach(item => {
        // Access the properties of each item
        if(item.Name==Name&&item.Email==Email)
        {
          userAlreadyExists = true;
          setTimeout(function(){
            $('.slide-alert').show().animate({right: '10px'}, 'fast');
              setTimeout(function() {
                $('.slide-alert').animate({right: '-300px'}, 'fast', function() {
                  $(this).hide();
                });
              }, 3000);
    //do what you need here
}, 2000);
          
        }
      });
      if (!userAlreadyExists) {
        createNewUser();
      }
    })
    .catch(error => console.error(error));

  async function createNewUser() {
    var jsonData= await generateUrl(Name,Email);
    var url = jsonData.UniqueUrl;
    var SecretKey = jsonData.SecretKey;
    console.log(url);
    const payload = {
      Status:'onHold',
      Name,
      Resume,
      Email,
      Recruiter,
      Experience,
      Notice_Period,
      lastWorkingDay,
      reasonWatchForSwitching,
      Current_Company,
      Interview_Rounds:[
        {
          Round1: {
            Date: "2023-04-09",
            Round: "Technical",
            Feedback: " ",
            Result: " ",
          }
        }
      ],
      url,
      SecretKey,
      keyStatus:"F",
      StartMonth,
      EndMonth
    };

    const url1 = 'https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/setAdminTableData'; // replace with your resource URL

    fetch(url1, {
      method: "POST",
      body: JSON.stringify(payload),
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(response => response.json())
    .then(data => {
      // handle response data
      console.log("hellloooooo"+data);
      location.reload();
      $('#myModal1').modal('hide');
    })
    .catch(error => {
      // handle errors
    });
  }
});



//--------------------------------
let gRowId=" ";
let gEmail=" ";
const dropdowns1 = document.getElementById('my-dropdown');
const dropdowns = document.querySelectorAll('#my-dropdown');
const dropdowns12 = document.querySelectorAll('.my-dropdown');

//this code will load the option in dropdown dynamically-----------------------------
dropdowns.forEach(dropdown => {
  // Get the name of the row that contains the dropdown
  // const name = dropdown.parentNode.parentNode.querySelector('td:first-child').textContent;
  const name = dropdown.parentNode.parentNode.querySelector('td:nth-child(2)').textContent;

// Fetch the data and add the options to the dropdown
//2
  // fetch(`https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData`)
   fetch(`https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableDataWithoutFile`)
    .then(response => response.json())
    .then(data => {
      data.forEach(item => {
        if(item._id==name) {
          for (let j = 0; j < item.Interview_Rounds.length; j++) {
            const round = item.Interview_Rounds[j];
            for (const key in round) {
              if (Object.hasOwnProperty.call(round, key)) {
                const option = document.createElement('option');
                option.text = key;
                option.value = key;
                dropdown.appendChild(option);
              }
            }
          }
        }
       
      });
      const allOption = document.createElement('option');
            allOption.value = 'all';
            allOption.textContent = 'All Interview Rounds';
            dropdown.appendChild(allOption);
    });
  
});

dropdowns.forEach((dropdown) => {
  dropdown.addEventListener('change', (event) => {
    console.log("hello")
    // const name = event.target.parentNode.parentNode.querySelector('td:first-child').textContent;
    const name = dropdown.parentNode.parentNode.querySelector('td:nth-child(2)').textContent;

    const selectedOption = event.target.value;
    const interviewRoundsDiv = dropdown.parentNode.querySelector('#interview-rounds');
    interviewRoundsDiv.innerHTML = '';
    const dropdownElement = event.target;
    console.log(name+"hello rahul"+selectedOption)

    //3
    // fetch(`https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData`)
    fetch(`https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableDataWithoutFile`)
      .then(response => response.json())
      .then(data => {
  
        console.log(data);
        // do something with the returned data
        for (let i = 0; i < data.length; i++) {
 const item = data[i];
 if(name==item._id)
 {
  console.log(item.Name)
  console.log("Interview Rounds:")
      for (let j = 0; j < item.Interview_Rounds.length; j++) {
        const round = item.Interview_Rounds[j];
        for (const key in round) {
          if (Object.hasOwnProperty.call(round, key)) {
            const roundObj = round[key];
            //  console.log(key);
             if(key==selectedOption)
             {
              console.log("selected option"+key)
              const roundDiv = document.createElement('div');
roundDiv.classList.add('interview-round');
roundDiv.innerHTML = `
  <div class="interview-round-title" style="text-align:center;"><strong>${key}</strong></div>
  <div><span class="interview-round-label">Date:</span> ${roundObj.Date}</div>
  <div><span class="interview-round-label">Round:</span> ${roundObj.Round}</div>
  <div><span class="interview-round-label">Feedback:</span> <input type="text"  id="${key}-feedback" value="${roundObj.Feedback}" class="feed" /></div>
  <div><span class="interview-round-label">Result:</span> <input type="text"   id="${key}-result" value="${roundObj.Result}" class="feed" /></div>

`;
interviewRoundsDiv.appendChild(roundDiv);
const feedbackInput = document.getElementById(`${key}-feedback`);
const resultInput = document.getElementById(`${key}-result`);
             }
             else if(selectedOption=="all"){
              console.log(selectedOption+"hellojii")
              const roundDiv = document.createElement('div');
roundDiv.classList.add('interview-round');
roundDiv.innerHTML = `
  <div class="interview-round-title" style="text-align:center;"><strong>${key}</strong></div>
  <div><span class="interview-round-label">Date:</span> ${roundObj.Date}</div>
  <div><span class="interview-round-label">Round:</span> ${roundObj.Round}</div>
  <div><span class="interview-round-label">Feedback:</span> <input type="text"  id="${key}-feedback" value="${roundObj.Feedback}"   class="feed"/></div>
  <div><span class="interview-round-label">Result:</span> <input type="text"  id="${key}-result" value="${roundObj.Result}"  class="feed"/></div>

`;
interviewRoundsDiv.appendChild(roundDiv);
             }
           
          }
        }
      }
    }
}
      })
      .catch(error => {
        console.error(error);
        // handle the error
      });
  });
});

var gNumber=0;

// Get all the buttons with the class "add-round-btn"
const addRoundButtons = document.querySelectorAll('#add-round-btn');

// Loop through the buttons and add a click event listener to each one
addRoundButtons.forEach(button => {
  button.addEventListener('click', () => {
    console.log("vlivked")
    const rowId = button.dataset.id;
    gRowId=rowId;
    console.log(gRowId)
    fetch('https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData')
  .then(response => response.json())
  .then(data => {
    console.log(data);
    // Iterate over the data array
    data.forEach(item => {
      // Access the properties of each item
      if(item._id==rowId)
      {
        gEmail=item.Email;
        console.log(item.Email);
         gNumber=item.Interview_Rounds.length+1;

         //post request
          // Prepare data for POST request
          const data2 = {
    
  filter: {
    url: item.url
  },
  submission_No:"1",
    submittedCode: "",
    inputParameter: " ",
    output: " ",
    roundNumber:gNumber
  }


        // Send POST request
        fetch('https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/updateRounds', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data2)
        })
          .then(response => response.json())
          .then(responseData => {
            // Handle the response from the POST request
            console.log(responseData);
          })
          .catch(error => console.error(error));
      
      }
      
      
    });
  })
  .catch(error => console.error(error));
    const modal = document.getElementById("myModal");
    modal.style.display = "block";
    const closeButton = document.querySelector('.close1');
  closeButton.addEventListener('click', () => {
    modal.style.display = "none";
  });
    
  
  });
});

//set the new round in the db---------------------------------------

///------------------------------------------
const form = document.querySelector('#my-form');
const roundTypeSelect = document.querySelector('#round-type');
const customRoundType = document.querySelector('#custom-round-type');


form.addEventListener('submit', event => {
  event.preventDefault(); // prevent default form submission behavior
  console.log(gRowId+"This is the id of addd button"+gEmail);
  // const roundNumber = document.querySelector('#round-number').value;
  // const roundType = document.querySelector('#round-type').value;
  // const roundDate = document.querySelector('#round-date').value;
  var roundType = roundTypeSelect.value;
    if (roundType === 'custom') {
      roundType = document.querySelector('#custom-round-type-input').value;
    }
    
    const roundNumber='';
    const roundDate = document.querySelector('#round-date').value;
  //   fetch(`https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData`)
  // .then(response => response.json())
  // .then(data => {
  //   for (let i = 0; i < data.length; i++) {
  //     const item = data[i];
  //     console.log(item);
  //     if(item._id==gRowId)
  //     {
  //      gNumber=item.Interview_Rounds.length+1;
  //      console.log(gNumber);
  //      break; 
  //     }
  //   }
  // })
  // .catch(error => console.error(error));
  const filter = {
    "Email": gEmail
  };

  const payload = {
    filter,
    roundNumber:gNumber,
    roundType,
    roundDate,
    Feedback: '',
    Result:'',
  };
  const url = 'https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/setInterviewRounds'; // replace with your resource URL

  fetch(url, {
    method: 'PUT',
    body: JSON.stringify(payload),
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(response => response.json())
  .then(data => {
    // handle response data
    console.log(data);
    location.reload();
    $('#myModal').modal('hide'); // hide the modal
  })
  .catch(error => {
    // handle errors
  });
});



async function generateUrl(Name, Email) {
  var UniqueUrl = '';
  var SecretKey = '';
  var myBoolean = false;

  try {
    const response = await fetch('https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getAdminTableData');
    const data = await response.json();

    for (let i = 0; i < data.length; i++) {
      const item = data[i];

      if (item.Name === Name && item.Email === Email) {
        myBoolean = true;
        UniqueUrl = item.url;
        SecretKey = item.Key;
        break;
      }
    }

    if (myBoolean === false) {
      const { uniqueUrl, stringToHash1 } = await setDetails(Name, Email);
      UniqueUrl = uniqueUrl;
      SecretKey = stringToHash1;
    }

    console.log("UniqueUrl", UniqueUrl);
    return { UniqueUrl, SecretKey };
  } catch (error) {
    console.error(error);
  }
}

async function setDetails(Name, Email) {
//   const apiUrl = `https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/submissions`; // Replace with your app ID and function name
// const url2 = 'https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/userSubmissions';

  const salt = Math.random().toString(36).substring(2, 15);
  const url2 = 'https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/userSubmissions';
  const stringToHash = Email + salt;
  console.log("key " + stringToHash)
  var hexHash = CryptoJS.SHA256(stringToHash)
  const uniqueUrl = "https://gem-code--editor.el.r.appspot.com/editor?name=".concat(hexHash);
  console.log(uniqueUrl)
  const salt1 = Math.random().toString(36).substring(2, 15);
  const stringToHash1 = salt1;


  const data2 = {
    "Rounds": [
      {
        "1":[
         {
          "Submission":"1",
          "SubmittedCode":"",
          "Input_Parameter":"",
          "Output":""
         }
        ]
      }
    
    ],
    "name": Name,
    "Questions":[],
    "url": uniqueUrl,
    "key": stringToHash1,
  }

  try {
    fetch(url2, {
  method: 'POST',
  body: JSON.stringify(data2),
  headers: {
    'Content-Type': 'application/json'
  }
})
.then(response => response.json())
.then(data => {
  // handle the response of the second request
  console.log('Response from API 2:', data);
})
.catch(error => console.error(error));

    return { uniqueUrl, stringToHash1 };
  } catch (error) {
    console.error(error);
  }
}

//--------Delete
const deleteIcons = document.querySelectorAll('.fa-solid.fa-trash');
deleteIcons.forEach(icon => {
  icon.addEventListener('click', () => {
    const idToDelete = icon.dataset.id;
    console.log("hello");
    console.log(idToDelete);
    fetch(`https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/deleteAdminTableData?id=${idToDelete}`, {
      method: 'DELETE'
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      console.log(`Object ${idToDelete} deleted successfully`);
      // Remove the table row from the UI
      const trElement = icon.closest('tr');
      trElement.parentNode.removeChild(trElement);
    })
    .catch(error => {
      console.error(`There was a problem deleting object ${idToDelete}:`, error);
    });
  });
});

$('.editable').on('dblclick', function() {
  // Make the content editable
  $(this).attr('contenteditable', true);
});


//----------Update editable col
$(document).ready(function() {
 
  // Add event listener to editable cells
  $('.editable').on('blur', function() {
    // Get the updated value
    var newValue = $(this).text();
    // Get the row id
    // var rowId = $(this).closest('td').data('id');
    var rowId = $(this).closest('tr').find('td:nth-child(2)').data('id');
    console.log(rowId);

    var key = $(this).data('key');

    console.log(key);
    var data = {
      rowId: rowId,
      newValue: newValue,
      key: key,
    };
    console.log(data)
    // Send the data to the server using AJAX
    $.ajax({
      url: '/updateTable',
      type: 'POST',
      data: data,
      success: function(response) {
        location.reload();
        // Handle success
      },
      error: function(xhr) {
        // Handle error
      }
    });
    
  });
});

//--------------
function searchTable1() {
  const input = document.getElementById("search-input");
const filter = input.value.toUpperCase();

// Get the labels container
const labelsContainer = document.getElementById("labels-container");
const labels = labelsContainer.getElementsByTagName("label");

// Loop through all labels and hide/show based on the search query
for (let i = 0; i < labels.length; i++) {
  const label = labels[i];
  const labelValue = label.textContent || label.innerText;
  
  if (labelValue.toUpperCase().indexOf(filter) > -1) {
    label.style.display = "";
  } else {
    label.style.display = "none";
  }
}
}
//------------


//----------------key session----------------------------
// const SecretKeyActivity = document.querySelectorAll('#key_btn');


// SecretKeyActivity.forEach(button => {
//   button.addEventListener('click', () => {
//     console.log("vlivked")
//     const row = button.closest('tr');
//     const secretKeyElement = row.querySelector('[data-secret-key]');
//     const secretKey = secretKeyElement.dataset.secretKey;

//     console.log("Secret Key:", secretKey);
   
  
     
//   var data = {
//     secretKey: secretKey,
    
//   };
//     $.ajax({
//   url: '/generate_session/' + secretKey,
//   type: 'POST',
//   data:data, // Replace with any additional data you want to send
//   success: function(response) {
//    console.log("hello msg send successfully")
//   },
//   error: function(xhr) {
//     // Handle error
//     alert("Error occurred: " + xhr.responseText);
//   }
// });
//   });
// });
const SecretKeyActivity = document.querySelectorAll('#key_btn');

let clickCount = 0;
let timeout;




SecretKeyActivity.forEach(button => {
  button.addEventListener('click', () => {
    clickCount++;
    if (clickCount === 1) {
      timeout = setTimeout(() => {
        // Single click action
        const row = button.closest('tr');
const rowIdElement = row.querySelector('[data-id]');
const rowId = rowIdElement.innerText; // or rowIdElement.textContent

        // const secretKey = secretKeyElement.dataset.secretKey;
        let newValue='';
        let key ='';
        

        var data = {
          rowId:rowId,
          newValue:'T',
          key:'keyStatus'

        };
console.log("single click")
console.log(rowId);
        $.ajax({
          url: '/updateTable',
          type: 'POST',
          data: data,
          success: function(response) {
            console.log("Single click: Request sent successfully");
            // location.reload();
          },
          error: function(xhr) {
            // Handle error
            alert("Error occurred: " + xhr.responseText);
          }
        });
       

        clickCount = 0; // Reset click count
       
      }, 300); // Change the delay as per your requirement
    } 
    else {
      clearTimeout(timeout);
      clickCount = 0;
      
     
      const row = button.closest('tr');
const rowIdElement = row.querySelector('[data-id]');
const rowId = rowIdElement.innerText; // or rowIdElement.textContent

      let newValue='';
        let key ='';
      console.log("double click")
      var data = {
        rowId:rowId,
    newValue:'F',
    key:'keyStatus'

    
  };
 $.ajax({
  url: '/updateTable',
  type: 'POST',
  data:data, // Replace with any additional data you want to send
  success: function(response) {
   console.log("successfully expire")
   
   location.reload();
  },
  error: function(xhr) {
    // Handle error
    alert("Error occurred: " + xhr.responseText);
  }
});


      console.log("Double click: Perform second request");
    }
    location.reload();
   });
  //  location.reload();
 });



 var dropdowns123 = document.getElementsByClassName('dropdown-check-list');
 var questionList = document.getElementById('questionList');

 Array.from(dropdowns123).forEach(function(dropdown) {
  var checkList = dropdown;
  var anchor = dropdown.getElementsByClassName('anchor')[0];
  

  anchor.onclick = function(evt) {
    
  
    console.log("hello ram");
    if (checkList.classList.contains('visible'))
      checkList.classList.remove('visible');
    else
      checkList.classList.add('visible');
  };

  var questionList = dropdown.querySelector('.items');

  fetch('https://us-east-1.aws.data.mongodb-api.com/app/application-0-awqqz/endpoint/getQuestion')
    .then(response => response.json())
    .then(data => {
      data.forEach(item => {
        var keys = Object.keys(item);
        var keysToDisplay = keys.slice(0, keys.length - 1); // Exclude the last key

        keysToDisplay.forEach(key => {
          var li = document.createElement('li');
          var input = document.createElement('input');
          input.type = 'checkbox';
          input.value = key;
          li.appendChild(input);
          li.appendChild(document.createTextNode(key));
          questionList.appendChild(li);
          input.addEventListener('click', function() {
          // Find the corresponding value for the clicked key
          var value = item[key];
          console.log(value);
        });
        });
        var submitButton = document.createElement('button');
  submitButton.id = 'submitbtn';
  submitButton.textContent = 'Submit';
  questionList.appendChild(submitButton);
        
      });
    })
    .catch(error => {
      console.error('Error:', error);
    });
  const form = dropdown.querySelector('form');
  form.addEventListener('submit', function(event) {
    event.preventDefault();

    const selectedOptions = Array.from(dropdown.querySelectorAll('input[type="checkbox"]:checked'))
      .map(checkbox => checkbox.value);

    console.log(selectedOptions); // or perform any other action with the selected options
    const formData = {
      selectedOptions: selectedOptions,
      
    };

  // Send the form data to the Flask route using fetch
  fetch('/question', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(formData)
  })
    .then(response => {
      if (response.ok) {
        console.log('Form data submitted successfully');
      } else {
        console.error('Failed to submit form data');
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
  });
});


// 2. Sorting | Ordering data of HTML table

const search = document.querySelector('.input-group input'),
    table_rows = document.querySelectorAll('tbody tr'),
    table_headings = document.querySelectorAll('thead th');

table_headings.forEach((head, i) => {
    let sort_asc = true;
    head.onclick = () => {
      console.log("hllooo")
        table_headings.forEach(head => head.classList.remove('active'));
        head.classList.add('active');

        document.querySelectorAll('td').forEach(td => td.classList.remove('active'));
        table_rows.forEach(row => {
            row.querySelectorAll('td')[i].classList.add('active');
        })

        head.classList.toggle('asc', sort_asc);
        sort_asc = head.classList.contains('asc') ? false : true;

        sortTable(i, sort_asc);
    }
})


function sortTable(column, sort_asc) {
    [...table_rows].sort((a, b) => {
        let first_row = a.querySelectorAll('td')[column].textContent.toLowerCase(),
            second_row = b.querySelectorAll('td')[column].textContent.toLowerCase();

        return sort_asc ? (first_row < second_row ? 1 : -1) : (first_row < second_row ? -1 : 1);
    })
        .map(sorted_row => document.querySelector('tbody').appendChild(sorted_row));
}

function sortTable1(columnHeader, sortAsc) {
  const tableRows = document.querySelectorAll('#dataTable tbody tr');
  const headerCells = document.querySelectorAll('#dataTable thead th');

  let columnIndex = -1;
  headerCells.forEach((cell, index) => {
    if (cell.textContent.trim() === columnHeader) {
      columnIndex = index;
    }
    
  });

  if (columnIndex === -1) {
    console.error(`Column "${columnHeader}" not found.`);
    return;
  }

  [...tableRows]
    .sort((a, b) => {
      let firstRow = a.querySelectorAll('td')[columnIndex].textContent.toLowerCase(),
          secondRow = b.querySelectorAll('td')[columnIndex].textContent.toLowerCase();

      return sortAsc ? (firstRow < secondRow ? -1 : 1) : (firstRow < secondRow ? 1 : -1);
    })
    .forEach(sortedRow => document.querySelector('#dataTable tbody').appendChild(sortedRow));
}


//------------------------------------------------------

$("#logout-button").on("click", function() {
  // Make an AJAX request to the Flask server to log the user out
  $.ajax({
    type: "POST", // or "GET" depending on your server configuration
    url: "/logout",
    success: function() {
      // Redirect the user to the login page after successful logout
      localStorage.clear();
      window.location.href = "/login";
    },
    error: function(xhr, status, error) {
      // Handle errors here
      console.error(error);
    }
  });
});

</script>
<script src="{{ url_for('static', filename='admin.js') }}"></script>

<script src="https://kit.fontawesome.com/3fcbd0cded.js" crossorigin="anonymous"></script>


</html>
